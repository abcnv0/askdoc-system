<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ricoh Document Discovery</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: #f9fafb; 
            overflow: hidden;
        }

        /* í—¤ë” */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #2563eb;
            color: white;
            padding: 16px;
            font-size: 24px;
            font-weight: bold;
            z-index: 10;
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            display: flex;
            height: 100vh;
            padding-top: 64px;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            background: white;
            border: none;
            transition: all 0.2s;
        }

        .tab:hover { background: #dbeafe; }
        .tab.active {
            background: #dbeafe;
            color: #1e40af;
            border-bottom-color: #1e40af;
        }

        .current-path {
            padding: 12px 16px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            font-size: 14px;
            color: #6b7280;
        }

        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .tree-item {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: background 0.2s;
        }

        .tree-item:hover { background: #dbeafe; }
        .tree-item.selected { 
            background: #dbeafe; 
            border-left: 3px solid #2563eb; 
        }
        .tree-item.selected-parent { 
            background: #fef3c7; 
            border-left: 3px solid #f59e0b; 
        }

        .expand-icon {
            margin-right: 4px;
            font-size: 12px;
            width: 16px;
            transition: transform 0.2s;
            color: #6b7280;
            cursor: pointer;
        }

        .expand-icon.expanded { transform: rotate(90deg); }
        .expand-icon.empty { visibility: hidden; }

        .tree-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        .tree-name {
            flex: 1;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .delete-btn {
            position: absolute;
            right: 8px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
            line-height: 1;
        }

        .tree-item:hover .delete-btn { display: block; }

        .depth-1 { padding-left: 28px; }
        .depth-2 { padding-left: 48px; }
        .depth-3 { padding-left: 68px; }
        .depth-4 { padding-left: 88px; }

        .actions {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            border-top: 1px solid #e5e7eb;
        }

        .btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: background 0.2s;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover { background: #1d4ed8; }

        .btn-success {
            background: #16a34a;
            color: white;
        }

        .btn-success:hover { background: #15803d; }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            display: flex;
        }

        .document-area {
            width: 50%;
            background: white;
            border-right: 1px solid #e5e7eb;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .filename-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: #faf5ff;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .document-content {
            flex: 1;
            border: 1px solid #e5e7eb;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            overflow-y: auto;
            line-height: 1.6;
            color: #374151;
            position: relative;
        }

        .document-iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 6px;
            background: white;
        }

        .no-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px;
            text-align: center;
            color: #6b7280;
        }

        .no-preview-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .download-btn {
            margin-top: 16px;
            padding: 12px 24px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .download-btn:hover {
            background: #1d4ed8;
        }

        /* ì´ë¯¸ì§€ ë·°ì–´ ìŠ¤íƒ€ì¼ */
        .image-viewer {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f8fafc;
            border-radius: 6px;
        }

        .image-viewer img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .image-viewer-controls {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 8px;
            background: rgba(0,0,0,0.7);
            border-radius: 6px;
            padding: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-viewer:hover .image-viewer-controls {
            opacity: 1;
        }

        .image-control-btn {
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            color: #374151;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .image-control-btn:hover {
            background: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .image-viewer-info {
            position: absolute;
            bottom: 12px;
            left: 12px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-viewer:hover .image-viewer-info {
            opacity: 1;
        }

        /* Office ë¬¸ì„œ ë·°ì–´ ìŠ¤íƒ€ì¼ (ì‹¤ì œ ë¬¸ì„œ í˜•íƒœ) */
        .office-viewer {
            position: relative;
            width: 100%;
            height: 100%;
            background: #e5e5e5;
            border-radius: 6px;
            overflow: hidden;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .office-viewer iframe {
            width: 100%;
            max-width: 850px;
            height: 100%;
            min-height: 600px;
            border: none;
            background: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-radius: 8px;
            transform: scale(1);
            transition: transform 0.3s ease;
        }

        .office-viewer:hover iframe {
            transform: scale(1.02);
        }

        .office-viewer-controls {
            position: absolute;
            top: 30px;
            right: 30px;
            display: flex;
            gap: 8px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            padding: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .office-viewer:hover .office-viewer-controls {
            opacity: 1;
        }

        .office-control-btn {
            background: rgba(255,255,255,0.95);
            border: none;
            border-radius: 6px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .office-control-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* ë¬¸ì„œ ì²« í˜ì´ì§€ ì•Œë¦¼ */
        .office-page-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .office-viewer:hover .office-page-indicator {
            opacity: 1;
        }

        .document-meta {
            border: 1px solid #e5e7eb;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 13px;
            color: #6b7280;
            line-height: 1.5;
        }

        .view-buttons {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .view-btn {
            flex: 1;
            height: 36px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: #f9fafb;
            color: #374151;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .view-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .view-btn:hover:not(.active) {
            background: #f3f4f6;
        }

        /* ê²€ìƒ‰ íŒ¨ë„ */
        .search-panel {
            width: 33.333%;
            background: white;
            padding: 16px;
            overflow-y: auto;
        }

        .search-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .result-card {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .result-card:hover { box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .result-card.selected {
            border-color: #2563eb;
            background: #dbeafe;
        }

        .result-title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .result-info {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 6px;
        }

        .result-bar {
            height: 6px;
            background: #2563eb;
            border-radius: 3px;
        }

        .explanation {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            font-size: 14px;
            color: #374151;
            line-height: 1.5;
            margin-top: 16px;
        }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            border-radius: 8px;
            padding: 24px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .modal h3 {
            margin-bottom: 16px;
            color: #374151;
            font-size: 18px;
        }

        .modal input,
        .modal select {
            width: 100%;
            padding: 10px;
            margin-bottom: 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .modal select {
            background: #dbeafe;
        }

        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-bottom: 16px;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .file-upload-area:hover { border-color: #2563eb; }
        .file-upload-area.dragover { border-color: #2563eb; background: #f0f8ff; }

        .file-info {
            font-size: 12px;
            color: #6b7280;
            margin-top: 8px;
        }

        .selected-file-info {
            padding: 10px;
            background: #dcfce7;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .modal-btn-primary {
            background: #2563eb;
            color: white;
        }

        .modal-btn-primary:hover { background: #1d4ed8; }
        .modal-btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .modal-btn-secondary {
            background: #f9fafb;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .modal-btn-secondary:hover { background: #f3f4f6; }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì•Œë¦¼ í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show { transform: translateX(0); }
        .toast.error { background: #ef4444; }

        /* ìœ í‹¸ë¦¬í‹° */
        .hidden { display: none !important; }
        .mt-4 { margin-top: 16px; }
        .mb-4 { margin-bottom: 16px; }
    </style>
</head>
<body>
    <div class="header">Ricoh Document Discovery</div>
    
    <div class="container">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <!-- íƒ­ -->
            <div class="tabs">
                <button class="tab active" id="tab-my">My ë¬¸ì„œí•¨</button>
                <button class="tab" id="tab-public">ê³µìš©ë¬¸ì„œí•¨</button>
            </div>

            <!-- í˜„ì¬ ê²½ë¡œ -->
            <div class="current-path" id="current-path">ğŸ“ ë£¨íŠ¸</div>

            <!-- íŒŒì¼ íŠ¸ë¦¬ -->
            <div class="file-tree" id="file-tree">
                <div style="text-align: center; padding: 20px; color: #6b7280;">
                    <div class="loading"></div>
                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="actions">
                <button class="btn btn-primary" onclick="openFolderModal()">
                    â• í´ë” ì¶”ê°€
                </button>
                <button class="btn btn-success" onclick="openDocumentModal()">
                    ğŸ“ ë¬¸ì„œ ì¶”ê°€
                </button>
            </div>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="main-content">
            <!-- ë¬¸ì„œ ì˜ì—­ -->
            <div class="document-area">
                <div class="section-title">ë¬¸ì„œ ë‚´ìš©</div>
                <input class="filename-input" id="filename-input" value="iPS_ë§¤ë‰´ì–¼.PDF" readonly />
                <div class="document-content" id="document-content">
                    ì´ ë¬¸ì„œëŠ” RICOH Koreaì—ì„œ ì œê³µí•˜ëŠ” ì›¹ ê¸°ë°˜ ë¬¸ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ, ìŠ¤ìº”/íŒ©ìŠ¤ ë¬¸ì„œë¥¼ ì›¹ê³¼ ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ ì €ì¥, ê³µìœ , ì´ë©”ì¼ ì „ì†¡, ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                    <div style="text-align: center; margin-top: 16px;">
                        <div style="display: inline-block; border: 2px dashed #d1d5db; padding: 32px; border-radius: 8px;">
                            ğŸ“„ iPS menual
                        </div>
                    </div>
                </div>
                <div class="document-meta" id="document-meta">
                    ì‘ì„±ì: iPS ê°œë°œíŒ€<br />
                    ìµœì¢… ìˆ˜ì •ì¼: 2023-09-15<br />
                    íŒŒì¼ í¬ê¸°: 254KB
                </div>
                <div class="view-buttons">
                    <button class="view-btn active" onclick="changeView('search')">ë¬¸ì„œí•¨ ë‚´ ì—°ê´€ë¬¸ì„œ ê²€ìƒ‰</button>
                    <button class="view-btn" onclick="changeView('email')">ì´ë©”ì¼ ì—°ê´€ë¬¸ì„œ ê²€ìƒ‰</button>
                    <button class="view-btn" onclick="changeView('summary')">ìš”ì•½ë‚´ìš© ë³´ê¸°</button>
                </div>
            </div>

            <!-- ê²€ìƒ‰ íŒ¨ë„ -->
            <div class="search-panel">
                <div class="section-title">ë¬¸ì„œ ê²€ìƒ‰</div>
                <input class="search-input" id="search-input" placeholder="ìì—°ì–´ ì§ˆì˜ ì…ë ¥..." />
                <div class="section-title">ì—°ê´€ ë¬¸ì„œ</div>
                
                <div class="result-card selected">
                    <div class="result-title">iPS_í™”ë©´_Design.pdf</div>
                    <div class="result-info">
                        ì—°ê´€ë„: 95%<br/>
                        ê³µí†µ í‚¤ì›Œë“œ: iPS_ìš”êµ¬ì‚¬í•­, iPS_í™”ë©´ë””ìì¸
                    </div>
                    <div class="result-bar" style="width: 95%;"></div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">iPS_ê°œë°œ ì•„í‚¤í…ì²˜.pdf</div>
                    <div class="result-info">
                        ì—°ê´€ë„: 92%<br/>
                        ê³µí†µ í‚¤ì›Œë“œ: iPS_ìš”êµ¬ì‚¬í•­, iPS_ê¸°ëŠ¥
                    </div>
                    <div class="result-bar" style="width: 92%;"></div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">iPS_ê°œë°œ íšŒì˜ë¡.pdf</div>
                    <div class="result-info">
                        ì—°ê´€ë„: 82%<br/>
                        ê³µí†µ í‚¤ì›Œë“œ: iPS_ìš”êµ¬ì‚¬í•­, iPS_ê¸°ëŠ¥
                    </div>
                    <div class="result-bar" style="width: 82%;"></div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">iPS_ì œì•ˆì„œ.pdf</div>
                    <div class="result-info">
                        ì—°ê´€ë„: 75%<br/>
                        ê³µí†µ í‚¤ì›Œë“œ: iPS_ìš”êµ¬ì‚¬í•­, iPS_ê¸°ëŠ¥
                    </div>
                    <div class="result-bar" style="width: 75%;"></div>
                </div>
                
                <div class="result-card">
                    <div class="result-title">iPS_ê¸°íšì•ˆ.pdf</div>
                    <div class="result-info">
                        ì—°ê´€ë„: 70%<br/>
                        ê³µí†µ í‚¤ì›Œë“œ: iPS_ìš”êµ¬ì‚¬í•­, iPS_ê¸°ëŠ¥
                    </div>
                    <div class="result-bar" style="width: 70%;"></div>
                </div>

                <div class="section-title mt-4">GPT ì—°ê´€ì„± ì„¤ëª…</div>
                <div class="explanation">
                    ì„ íƒí•œ ë¬¸ì„œëŠ” iPS ì†”ë£¨ì…˜ ì‚¬ìš©ì ë§¤ë‰´ì–¼ì´ë©° ì›í•˜ì‹œë©´ ê´€ë¦¬ì ë§¤ë‰´ì–¼ ë° ì‹œìŠ¤í…œ ì„¤ì¹˜ ë§¤ë‰´ì–¼ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>
    </div>

    <!-- í´ë” ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="folder-modal">
        <div class="modal">
            <h3>ìƒˆ í´ë” ì¶”ê°€</h3>
            <input type="text" id="folder-name" placeholder="í´ë”ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" />
            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #374151;">ìƒì„± ìœ„ì¹˜:</label>
            <select id="folder-location"></select>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeFolderModal()">ì·¨ì†Œ</button>
                <button class="modal-btn modal-btn-primary" onclick="createFolder()">ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <!-- ë¬¸ì„œ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="document-modal">
        <div class="modal">
            <h3>ìƒˆ ë¬¸ì„œ ì¶”ê°€</h3>
            <div class="file-upload-area" onclick="triggerFileInput()">
                <p>ğŸ“ íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
                <div class="file-info">ì§€ì› í˜•ì‹: PDF, DOC, DOCX, XLS, XLSX, PNG, JPG (ìµœëŒ€ 50MB)</div>
            </div>
            <input type="file" id="file-input" style="display: none;" 
                   accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg" />
            <div id="selected-file-info" class="selected-file-info hidden">
                <strong>ì„ íƒëœ íŒŒì¼:</strong> <span id="file-name"></span><br>
                <strong>í¬ê¸°:</strong> <span id="file-size"></span>
            </div>
            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #374151;">ì—…ë¡œë“œ ìœ„ì¹˜:</label>
            <select id="document-location"></select>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeDocumentModal()">ì·¨ì†Œ</button>
                <button class="modal-btn modal-btn-primary" id="upload-btn" onclick="uploadDocument()" disabled>
                    ì—…ë¡œë“œ
                </button>
            </div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div class="toast" id="toast"></div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let currentTab = 'my';
        let selectedItem = { id: 'doc2', name: 'iPS_ë§¤ë‰´ì–¼.pdf', type: 'document' };
        let selectedFolder = null;
        let selectedFile = null;
        let currentView = 'search';
        let folders = [];
        let files = [];

        // API ê¸°ë³¸ URL
        const API_BASE = window.location.origin + '/api';

        // ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸ í•¨ìˆ˜
        async function checkServerConnection() {
            try {
                console.log('ì„œë²„ ì—°ê²° í™•ì¸ ì¤‘...');
                
                // 5ì´ˆ íƒ€ì„ì•„ì›ƒ ì„¤ì •
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(API_BASE + '/folders/my', {
                    signal: controller.signal,
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                clearTimeout(timeoutId);
                console.log('ì„œë²„ ì‘ë‹µ:', response.status);
                return response.ok;
                
            } catch (error) {
                console.log('ì„œë²„ ì—°ê²° ì‹¤íŒ¨:', error.name, error.message);
                
                if (error.name === 'AbortError') {
                    console.log('ì„œë²„ ì—°ê²° íƒ€ì„ì•„ì›ƒ');
                }
                return false;
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${isError ? 'error' : ''} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('ko-KR');
        }

        function findFolderById(folders, id) {
            // IDë¥¼ ìˆ«ìë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
            const targetId = parseInt(id);
            for (let folder of folders) {
                if (parseInt(folder.id) === targetId) return folder;
                if (folder.children) {
                    const found = findFolderById(folder.children, targetId);
                    if (found) return found;
                }
            }
            return null;
        }

        // í´ë”ì˜ ì „ì²´ ê²½ë¡œë¥¼ ì°¾ëŠ” í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function findFolderPath(folders, targetId, currentPath = []) {
            // IDë¥¼ ìˆ«ìë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
            const targetIdNum = parseInt(targetId);
            for (let folder of folders) {
                const newPath = [...currentPath, folder];
                
                if (parseInt(folder.id) === targetIdNum) {
                    return newPath;
                }
                
                if (folder.children) {
                    const found = findFolderPath(folder.children, targetIdNum, newPath);
                    if (found) return found;
                }
            }
            return null;
        }

        // í´ë”ì˜ í˜„ì¬ í¼ì¹¨ ìƒíƒœë¥¼ ìˆ˜ì§‘í•˜ëŠ” í•¨ìˆ˜
        function collectExpandedFolders(folderList) {
            const expanded = [];
            
            function collectRecursive(folders) {
                folders.forEach(folder => {
                    if (folder.expanded) {
                        expanded.push(parseInt(folder.id));
                    }
                    if (folder.children) {
                        collectRecursive(folder.children);
                    }
                });
            }
            
            collectRecursive(folderList);
            return expanded;
        }

        // í´ë” í¼ì¹¨ ìƒíƒœë¥¼ ë³µì›í•˜ëŠ” í•¨ìˆ˜
        function restoreExpandedFolders(folderList, expandedIds) {
            function restoreRecursive(folders) {
                folders.forEach(folder => {
                    if (expandedIds.includes(parseInt(folder.id))) {
                        folder.expanded = true;
                    }
                    if (folder.children) {
                        restoreRecursive(folder.children);
                    }
                });
            }
            
            restoreRecursive(folderList);
        }

        // íŒŒì¼ ì—…ë¡œë“œ í›„ ìë™ìœ¼ë¡œ í•´ë‹¹ í´ë” í¼ì¹˜ê¸° (ë””ë²„ê¹… ê°•í™”)
        function autoExpandToFolder(targetFolderId) {
            if (!targetFolderId) {
                console.log('targetFolderIdê°€ ì—†ìŒ, ìë™ í¼ì¹˜ê¸° ê±´ë„ˆëœ€');
                return;
            }
            
            console.log(`=== ìë™ í´ë” í¼ì¹˜ê¸° ì‹œì‘ ===`);
            console.log(`ëŒ€ìƒ í´ë” ID: ${targetFolderId}`);
            
            // í•´ë‹¹ í´ë”ê¹Œì§€ì˜ ê²½ë¡œë¥¼ ì°¾ì•„ì„œ ëª¨ë‘ í¼ì¹˜ê¸°
            function expandPathTo(folderList, targetId, parentPath = []) {
                for (let folder of folderList) {
                    const currentPath = [...parentPath, folder];
                    
                    console.log(`í´ë” í™•ì¸: "${folder.name}" (id: ${folder.id}), ì°¾ëŠ” ID: ${targetId}`);
                    
                    if (parseInt(folder.id) === parseInt(targetId)) {
                        console.log(`ëŒ€ìƒ í´ë” ì°¾ìŒ! ê²½ë¡œìƒì˜ ëª¨ë“  í´ë” í¼ì¹˜ê¸° ì‹œì‘`);
                        // ê²½ë¡œìƒì˜ ëª¨ë“  í´ë”ë¥¼ í¼ì¹˜ê¸°
                        currentPath.forEach(pathFolder => {
                            pathFolder.expanded = true;
                            console.log(`âœ“ í´ë” í¼ì¹¨: "${pathFolder.name}" (id: ${pathFolder.id})`);
                        });
                        console.log(`ê²½ë¡œ í¼ì¹˜ê¸° ì™„ë£Œ!`);
                        return true;
                    }
                    
                    if (folder.children && folder.children.length > 0) {
                        if (expandPathTo(folder.children, targetId, currentPath)) {
                            return true;
                        }
                    }
                }
                return false;
            }
            
            const found = expandPathTo(folders, targetFolderId);
            if (found) {
                console.log(`âœ… ìë™ í´ë” í¼ì¹˜ê¸° ì„±ê³µ: ${targetFolderId}`);
            } else {
                console.log(`âŒ ëŒ€ìƒ í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${targetFolderId}`);
                console.log('í˜„ì¬ í´ë” êµ¬ì¡°:');
                logFolderStructure(folders);
            }
            console.log(`=== ìë™ í´ë” í¼ì¹˜ê¸° ì™„ë£Œ ===`);
        }

        // í´ë” êµ¬ì¡° ë¡œê¹… í•¨ìˆ˜ (ë””ë²„ê¹…ìš©)
        function logFolderStructure(folderList, depth = 0) {
            folderList.forEach(folder => {
                const indent = '  '.repeat(depth);
                console.log(`${indent}ğŸ“ ${folder.name} (id: ${folder.id}, expanded: ${!!folder.expanded})`);
                if (folder.children && folder.children.length > 0) {
                    logFolderStructure(folder.children, depth + 1);
                }
            });
        }

        // API í˜¸ì¶œ í•¨ìˆ˜ë“¤
        async function loadFolders() {
            try {
                console.log(`í´ë” ë¡œë”© ì‹œì‘: /api/folders/${currentTab}`);
                const response = await fetch(`${API_BASE}/folders/${currentTab}`);
                if (!response.ok) throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
                const data = await response.json();
                console.log('í´ë” ë°ì´í„° ì›ë³¸:', data);
                console.log('í´ë” ê°œìˆ˜:', data.length);
                
                // ë§Œì•½ flat ë°°ì—´ì´ë¼ë©´ ì§ì ‘ ê³„ì¸µ êµ¬ì¡°ë¥¼ ë§Œë“¤ê¸°
                let processedData = data;
                if (data.length > 0 && !data[0].hasOwnProperty('children')) {
                    console.log('Flat ë°°ì—´ ê°ì§€, ê³„ì¸µ êµ¬ì¡° ìƒì„± ì¤‘...');
                    processedData = buildClientSideTree(data);
                }
                
                // í´ë” êµ¬ì¡° ìƒì„¸ ì¶œë ¥
                function printDetailedFolders(folderList, depth = 0) {
                    folderList.forEach(folder => {
                        const indent = '  '.repeat(depth);
                        console.log(`${indent}í´ë”: ${folder.name} (id: ${folder.id}, parent_id: ${folder.parent_id})`);
                        if (folder.children && folder.children.length > 0) {
                            printDetailedFolders(folder.children, depth + 1);
                        }
                    });
                }
                
                console.log('ìƒì„¸ í´ë” êµ¬ì¡°:');
                printDetailedFolders(processedData);
                
                folders = processedData;
                return processedData;
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    console.error('ì„œë²„ ì—°ê²° ì‹¤íŒ¨:', error);
                    throw new Error('ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
                } else {
                    console.error('í´ë” ë¡œë”© ì˜¤ë¥˜:', error);
                    throw new Error(`í´ë”ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                }
            }
        }

        // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê³„ì¸µ êµ¬ì¡° ìƒì„±í•˜ëŠ” í•¨ìˆ˜
        function buildClientSideTree(flatArray) {
            console.log('í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê³„ì¸µ êµ¬ì¡° ìƒì„±:', flatArray);
            
            const buildTree = (items, parentId = null) => {
                return items
                    .filter(item => item.parent_id === parentId)
                    .map(item => {
                        const children = buildTree(items, item.id);
                        console.log(`íŠ¸ë¦¬ ë¹Œë”©: ${item.name} (id: ${item.id}) -> children: ${children.length}ê°œ`);
                        return {
                            ...item,
                            children: children
                        };
                    });
            };
            
            return buildTree(flatArray);
        }

        async function loadFiles(folderId = null) {
            try {
                const url = `${API_BASE}/files/${currentTab}${folderId ? `?folderId=${folderId}` : ''}`;
                console.log(`íŒŒì¼ ë¡œë”© API í˜¸ì¶œ: ${url}`);
                const response = await fetch(url);
                if (!response.ok) throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
                const data = await response.json();
                console.log(`íŒŒì¼ ë°ì´í„° (folderId: ${folderId}):`, data);
                console.log(`ë¡œë“œëœ íŒŒì¼ ê°œìˆ˜: ${data.length}`);
                
                // ê° íŒŒì¼ì˜ folder_id ì •ë³´ ì¶œë ¥
                data.forEach((file, index) => {
                    console.log(`  íŒŒì¼ ${index + 1}: ${file.original_name || file.name} (id: ${file.id}, folder_id: ${file.folder_id})`);
                });
                
                return data;
            } catch (error) {
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    console.error('ì„œë²„ ì—°ê²° ì‹¤íŒ¨:', error);
                    throw new Error('ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
                } else {
                    console.error('íŒŒì¼ ë¡œë”© ì˜¤ë¥˜:', error);
                    throw new Error(`íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                }
            }
        }

        async function createFolderApi(name, parentId, tabType) {
            try {
                console.log('í´ë” ìƒì„± API í˜¸ì¶œ:', { name, parentId, tabType });
                
                const requestBody = { 
                    name, 
                    parentId: parentId ? parseInt(parentId) : null,  // ìˆ«ìë¡œ ë³€í™˜
                    tabType 
                };
                console.log('ìš”ì²­ ë³¸ë¬¸:', requestBody);
                
                const response = await fetch(`${API_BASE}/folders`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                console.log('í´ë” ìƒì„± ì‘ë‹µ:', { status: response.status, data });
                
                if (!response.ok) {
                    throw new Error(data.error || 'í´ë” ìƒì„± ì‹¤íŒ¨');
                }
                return data;
            } catch (error) {
                console.error('í´ë” ìƒì„± ì˜¤ë¥˜:', error);
                showToast(`í´ë” ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`, true);
                throw error;
            }
        }

        async function uploadFileApi(file, folderId, tabType) {
            try {
                console.log('íŒŒì¼ ì—…ë¡œë“œ API í˜¸ì¶œ:', { fileName: file.name, folderId, tabType });
                
                const formData = new FormData();
                formData.append('file', file);
                formData.append('folderId', folderId ? parseInt(folderId) : '');  // ìˆ«ìë¡œ ë³€í™˜
                formData.append('tabType', tabType);

                console.log('FormData ë‚´ìš©:', {
                    file: file.name,
                    folderId: folderId ? parseInt(folderId) : null,
                    tabType
                });

                const response = await fetch(`${API_BASE}/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                console.log('íŒŒì¼ ì—…ë¡œë“œ ì‘ë‹µ:', { status: response.status, data });

                if (!response.ok) {
                    throw new Error(data.error || 'íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨');
                }
                return data;
            } catch (error) {
                console.error('íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                showToast(`íŒŒì¼ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`, true);
                throw error;
            }
        }

        async function deleteFolderApi(id) {
            try {
                console.log('í´ë” ì‚­ì œ ì‹œë„:', id);
                const response = await fetch(`${API_BASE}/folders/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                console.log('í´ë” ì‚­ì œ ì‘ë‹µ:', data);
                
                if (!response.ok) {
                    throw new Error(data.error || 'í´ë” ì‚­ì œ ì‹¤íŒ¨');
                }
                return data;
            } catch (error) {
                console.error('í´ë” ì‚­ì œ ì˜¤ë¥˜:', error);
                showToast(`í´ë” ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`, true);
                throw error;
            }
        }

        async function deleteFileApi(id) {
            try {
                console.log('íŒŒì¼ ì‚­ì œ ì‹œë„:', id);
                const response = await fetch(`${API_BASE}/files/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                console.log('íŒŒì¼ ì‚­ì œ ì‘ë‹µ:', data);
                
                if (!response.ok) {
                    throw new Error(data.error || 'íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨');
                }
                return data;
            } catch (error) {
                console.error('íŒŒì¼ ì‚­ì œ ì˜¤ë¥˜:', error);
                showToast(`íŒŒì¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`, true);
                throw error;
            }
        }

        // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œí•˜ì§€ ì•Šê³  ë Œë”ë§ë§Œ í•˜ëŠ” í•¨ìˆ˜ (ë””ë²„ê¹… ê°•í™”)
        async function renderFileTreeWithoutReload() {
            try {
                console.log(`=== íŒŒì¼ íŠ¸ë¦¬ ë Œë”ë§ ì‹œì‘ ===`);
                console.log('í˜„ì¬ selectedFolder:', selectedFolder);
                
                const fileTree = document.getElementById('file-tree');
                
                // ëª¨ë“  í´ë”ì˜ íŒŒì¼ë“¤ì„ ë¯¸ë¦¬ ë¡œë“œí•´ì„œ í´ë”ë³„ë¡œ ë¶„ë¥˜
                const allFiles = await loadAllFiles();
                const filesByFolder = groupFilesByFolder(allFiles);
                
                let html = '';

                async function renderItem(item, depth = 0) {
                    const isFolder = item.children !== undefined || item.type === 'folder';
                    const hasChildren = isFolder && (item.children && item.children.length > 0);
                    
                    // í´ë”ì¸ ê²½ìš°, í•´ë‹¹ í´ë”ì˜ íŒŒì¼ë“¤ë„ ì²´í¬
                    let hasFolderFiles = false;
                    const folderKey = isFolder ? item.id.toString() : null;
                    
                    if (isFolder && filesByFolder[folderKey]) {
                        hasFolderFiles = filesByFolder[folderKey].length > 0;
                        console.log(`í´ë” "${item.name}" (id: ${item.id})ì— ${filesByFolder[folderKey].length}ê°œ íŒŒì¼ ìˆìŒ`);
                    }
                    
                    const hasAnyChildren = hasChildren || hasFolderFiles;
                    const expandIcon = hasAnyChildren ? (item.expanded ? 'â–¼' : 'â–¶') : 'â€¢';
                    const expandClass = hasAnyChildren ? (item.expanded ? 'expanded' : '') : 'empty';
                    
                    const selectedClass = selectedItem?.id == item.id ? ' selected' : '';
                    const selectedParentClass = selectedFolder == parseInt(item.id) ? ' selected-parent' : '';
                    const depthClass = depth > 0 ? ` depth-${Math.min(depth, 4)}` : '';
                    
                    const icon = isFolder ? 'ğŸ“' : 'ğŸ“„';
                    const name = isFolder ? item.name : (item.original_name || item.name);
                    
                    console.log(`ë Œë”ë§: ${isFolder ? 'í´ë”' : 'íŒŒì¼'} "${name}" (depth: ${depth}, expanded: ${item.expanded})`);
                    
                    html += `
                        <div class="tree-item${selectedClass}${selectedParentClass}${depthClass}" onclick="selectItem('${item.id}', '${isFolder ? 'folder' : 'document'}')">
                            ${isFolder ? `<span class="expand-icon ${expandClass}" onclick="toggleFolder(event, '${item.id}')">${expandIcon}</span>` : '<span class="expand-icon empty"></span>'}
                            <span class="tree-icon">${icon}</span>
                            <span class="tree-name">${name}</span>
                            <button class="delete-btn" onclick="deleteItem(event, '${item.id}', '${isFolder ? 'folder' : 'document'}', '${name.replace(/'/g, '\\\'')}')" title="ì‚­ì œ">Ã—</button>
                        </div>
                    `;
                    
                    // í´ë”ê°€ í¼ì³ì ¸ ìˆëŠ” ê²½ìš°
                    if (isFolder && item.expanded) {
                        console.log(`í´ë” "${item.name}" í¼ì³ì§ - í•˜ìœ„ í•­ëª© ë Œë”ë§ ì‹œì‘`);
                        
                        // 1. í•˜ìœ„ í´ë”ë“¤ ë Œë”ë§
                        if (hasChildren) {
                            console.log(`í•˜ìœ„ í´ë” ${item.children.length}ê°œ ë Œë”ë§`);
                            item.children.forEach(child => renderItem(child, depth + 1));
                        }
                        
                        // 2. í•´ë‹¹ í´ë”ì˜ íŒŒì¼ë“¤ ë Œë”ë§
                        if (hasFolderFiles) {
                            const folderFiles = filesByFolder[folderKey];
                            console.log(`í´ë” "${item.name}"(id: ${item.id})ì˜ íŒŒì¼ ${folderFiles.length}ê°œ ë Œë”ë§ ì‹œì‘`);
                            folderFiles.forEach(file => {
                                console.log(`  íŒŒì¼ ë Œë”ë§: "${file.original_name || file.name}" (id: ${file.id}, folder_id: ${file.folder_id})`);
                                renderItem(file, depth + 1);
                            });
                            console.log(`í´ë” "${item.name}"ì˜ íŒŒì¼ ë Œë”ë§ ì™„ë£Œ`);
                        }
                    } else if (isFolder) {
                        console.log(`í´ë” "${item.name}" ì ‘í˜€ìˆìŒ - í•˜ìœ„ í•­ëª© ê±´ë„ˆëœ€`);
                    }
                }

                // í´ë” ë Œë”ë§
                console.log(`=== ë£¨íŠ¸ í´ë” ë Œë”ë§ ì‹œì‘ ===`);
                console.log(`ë£¨íŠ¸ í´ë” ê°œìˆ˜: ${folders.length}`);
                for (const folder of folders) {
                    await renderItem(folder, 0);
                }
                
                // ë£¨íŠ¸ íŒŒì¼ë“¤ ë Œë”ë§ (folder_idê°€ nullì¸ íŒŒì¼ë“¤)
                const rootFiles = filesByFolder['null'] || [];
                console.log(`=== ë£¨íŠ¸ íŒŒì¼ ë Œë”ë§ ì‹œì‘ ===`);
                console.log(`ë£¨íŠ¸ íŒŒì¼ ê°œìˆ˜: ${rootFiles.length}`);
                rootFiles.forEach(file => {
                    console.log(`ë£¨íŠ¸ íŒŒì¼ ë Œë”ë§: "${file.original_name || file.name}" (id: ${file.id}, folder_id: ${file.folder_id})`);
                    renderItem(file, 0);
                });

                fileTree.innerHTML = html || '<div style="text-align: center; padding: 20px; color: #6b7280;">í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                updateCurrentPath();
                
                console.log(`=== íŒŒì¼ íŠ¸ë¦¬ ë Œë”ë§ ì™„ë£Œ ===`);

            } catch (error) {
                console.error('íŒŒì¼ íŠ¸ë¦¬ ë Œë”ë§ ì˜¤ë¥˜:', error);
                const fileTree = document.getElementById('file-tree');
                if (fileTree) {
                    fileTree.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #ef4444;">
                            <div style="font-size: 48px; margin-bottom: 16px;">âš ï¸</div>
                            <p><strong>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</strong></p>
                            <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">
                                ${error.message}
                            </p>
                            <button onclick="renderFileTree()" style="margin-top: 16px; padding: 8px 16px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                ë‹¤ì‹œ ì‹œë„
                            </button>
                        </div>
                    `;
                }
            }
        }

        // ëª¨ë“  íŒŒì¼ì„ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜ (ë””ë²„ê¹… ê°•í™”)
        async function loadAllFiles() {
            try {
                const url = `${API_BASE}/files/${currentTab}`;
                console.log(`=== ëª¨ë“  íŒŒì¼ ë¡œë”© ì‹œì‘ ===`);
                console.log(`API í˜¸ì¶œ: ${url}`);
                
                const response = await fetch(url);
                if (!response.ok) throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
                
                const data = await response.json();
                console.log(`ëª¨ë“  íŒŒì¼ ë¡œë“œ ì™„ë£Œ: ${data.length}ê°œ`);
                
                // ê° íŒŒì¼ì˜ ìƒì„¸ ì •ë³´ ì¶œë ¥
                data.forEach((file, index) => {
                    console.log(`íŒŒì¼ ${index + 1}: ${file.original_name || file.name} (id: ${file.id}, folder_id: ${file.folder_id})`);
                });
                
                console.log(`=== ëª¨ë“  íŒŒì¼ ë¡œë”© ì™„ë£Œ ===`);
                return data;
            } catch (error) {
                console.error('ëª¨ë“  íŒŒì¼ ë¡œë”© ì˜¤ë¥˜:', error);
                return [];
            }
        }

        // íŒŒì¼ë“¤ì„ í´ë”ë³„ë¡œ ê·¸ë£¹í™”í•˜ëŠ” í•¨ìˆ˜ (ë””ë²„ê¹… ê°•í™”)
        function groupFilesByFolder(files) {
            console.log(`=== íŒŒì¼ ê·¸ë£¹í™” ì‹œì‘ ===`);
            console.log(`ì´ íŒŒì¼ ê°œìˆ˜: ${files.length}`);
            
            const grouped = {};
            files.forEach(file => {
                const folderId = file.folder_id;
                const folderKey = folderId === null ? 'null' : folderId.toString();
                
                if (!grouped[folderKey]) {
                    grouped[folderKey] = [];
                }
                grouped[folderKey].push(file);
                
                console.log(`íŒŒì¼ "${file.original_name || file.name}" â†’ í´ë” í‚¤: "${folderKey}"`);
            });
            
            console.log('=== í´ë”ë³„ íŒŒì¼ ê·¸ë£¹í™” ê²°ê³¼ ===');
            Object.keys(grouped).forEach(folderId => {
                const folderName = folderId === 'null' ? 'ë£¨íŠ¸' : `í´ë” ID ${folderId}`;
                console.log(`${folderName}: ${grouped[folderId].length}ê°œ íŒŒì¼`);
                grouped[folderId].forEach(file => {
                    console.log(`  - ${file.original_name || file.name} (id: ${file.id})`);
                });
            });
            console.log(`=== íŒŒì¼ ê·¸ë£¹í™” ì™„ë£Œ ===`);
            
            return grouped;
        }

        // ë©”ì¸ ë Œë”ë§ í•¨ìˆ˜ (ìˆ˜ì •ë¨)
        async function renderFileTree() {
            const fileTree = document.getElementById('file-tree');
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            fileTree.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #6b7280;">
                    <div class="loading"></div>
                    ì„œë²„ ì—°ê²° í™•ì¸ ì¤‘...
                </div>
            `;
            
            try {
                // ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸
                console.log('ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸ ì‹œì‘');
                const isConnected = await checkServerConnection();
                console.log('ì„œë²„ ì—°ê²° ìƒíƒœ:', isConnected);
                
                if (!isConnected) {
                    fileTree.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #ef4444;">
                            <div style="font-size: 48px; margin-bottom: 16px;">ğŸš«</div>
                            <p><strong>ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</strong></p>
                            <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">
                                ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.<br/>
                                <code style="background: #f3f4f6; padding: 2px 4px; border-radius: 3px;">node server.js</code>ë¡œ ì„œë²„ë¥¼ ì‹œì‘í•œ í›„<br/>
                                <code style="background: #f3f4f6; padding: 2px 4px; border-radius: 3px;">http://localhost:3000</code>ìœ¼ë¡œ ì ‘ì†í•˜ì„¸ìš”.
                            </p>
                            <button onclick="renderFileTree()" style="margin-top: 16px; padding: 8px 16px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                ë‹¤ì‹œ ì‹œë„
                            </button>
                        </div>
                    `;
                    return;
                }

                console.log('ì„œë²„ ì—°ê²° ì„±ê³µ, ë°ì´í„° ë¡œë”© ì‹œì‘');
                
                // í´ë” êµ¬ì¡° ë¡œë“œ
                await loadFolders();
                
                // ëª¨ë“  íŒŒì¼ë“¤ì„ ë¡œë“œí•´ì„œ í´ë”ë³„ë¡œ ë¶„ë¥˜
                const allFiles = await loadAllFiles();
                const filesByFolder = groupFilesByFolder(allFiles);
                
                let html = '';

                async function renderItem(item, depth = 0) {
                    const isFolder = item.children !== undefined || item.type === 'folder';
                    const hasChildren = isFolder && (item.children && item.children.length > 0);
                    
                    // í´ë”ì¸ ê²½ìš°, í•´ë‹¹ í´ë”ì˜ íŒŒì¼ë“¤ë„ ì²´í¬
                    let hasFolderFiles = false;
                    if (isFolder && filesByFolder[item.id]) {
                        hasFolderFiles = filesByFolder[item.id].length > 0;
                    }
                    
                    const hasAnyChildren = hasChildren || hasFolderFiles;
                    const expandIcon = hasAnyChildren ? (item.expanded ? 'â–¼' : 'â–¶') : 'â€¢';
                    const expandClass = hasAnyChildren ? (item.expanded ? 'expanded' : '') : 'empty';
                    
                    const selectedClass = selectedItem?.id == item.id ? ' selected' : '';
                    const selectedParentClass = selectedFolder == parseInt(item.id) ? ' selected-parent' : '';
                    const depthClass = depth > 0 ? ` depth-${Math.min(depth, 4)}` : '';
                    
                    const icon = isFolder ? 'ğŸ“' : 'ğŸ“„';
                    const name = isFolder ? item.name : (item.original_name || item.name);
                    
                    html += `
                        <div class="tree-item${selectedClass}${selectedParentClass}${depthClass}" onclick="selectItem('${item.id}', '${isFolder ? 'folder' : 'document'}')">
                            ${isFolder ? `<span class="expand-icon ${expandClass}" onclick="toggleFolder(event, '${item.id}')">${expandIcon}</span>` : '<span class="expand-icon empty"></span>'}
                            <span class="tree-icon">${icon}</span>
                            <span class="tree-name">${name}</span>
                            <button class="delete-btn" onclick="deleteItem(event, '${item.id}', '${isFolder ? 'folder' : 'document'}', '${name.replace(/'/g, '\\\'')}')" title="ì‚­ì œ">Ã—</button>
                        </div>
                    `;
                    
                    // í´ë”ê°€ í¼ì³ì ¸ ìˆëŠ” ê²½ìš°
                    if (isFolder && item.expanded) {
                        // 1. í•˜ìœ„ í´ë”ë“¤ ë Œë”ë§
                        if (hasChildren) {
                            item.children.forEach(child => renderItem(child, depth + 1));
                        }
                        
                        // 2. í•´ë‹¹ í´ë”ì˜ íŒŒì¼ë“¤ ë Œë”ë§
                        if (hasFolderFiles) {
                            const folderFiles = filesByFolder[item.id];
                            console.log(`í´ë” ${item.name}(id: ${item.id})ì˜ íŒŒì¼ë“¤ ë Œë”ë§:`, folderFiles.length, 'ê°œ');
                            folderFiles.forEach(file => {
                                console.log(`  - íŒŒì¼: ${file.original_name || file.name} (folder_id: ${file.folder_id})`);
                                renderItem(file, depth + 1);
                            });
                        }
                    }
                }

                // í´ë” ë Œë”ë§
                console.log('í´ë” ë Œë”ë§ ì‹œì‘, í´ë” ê°œìˆ˜:', folders.length);
                for (const folder of folders) {
                    await renderItem(folder, 0);
                }
                
                // ë£¨íŠ¸ íŒŒì¼ë“¤ ë Œë”ë§ (folder_idê°€ nullì¸ íŒŒì¼ë“¤)
                const rootFiles = filesByFolder[null] || [];
                console.log(`ë£¨íŠ¸ íŒŒì¼ ë Œë”ë§ ì‹œì‘, íŒŒì¼ ê°œìˆ˜: ${rootFiles.length}`);
                rootFiles.forEach(file => {
                    console.log(`  ë£¨íŠ¸ íŒŒì¼: ${file.original_name || file.name} (folder_id: ${file.folder_id})`);
                    renderItem(file, 0);
                });

                const fileTree = document.getElementById('file-tree');
                fileTree.innerHTML = html || '<div style="text-align: center; padding: 20px; color: #6b7280;">í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                updateCurrentPath();

            } catch (error) {
                console.error('íŒŒì¼ íŠ¸ë¦¬ ë Œë”ë§ ì˜¤ë¥˜:', error);
                document.getElementById('file-tree').innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #ef4444;">
                        <div style="font-size: 48px; margin-bottom: 16px;">âš ï¸</div>
                        <p><strong>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</strong></p>
                        <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">
                            ${error.message}
                        </p>
                        <button onclick="renderFileTree()" style="margin-top: 16px; padding: 8px 16px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            ë‹¤ì‹œ ì‹œë„
                        </button>
                    </div>
                `;
            }
        }

        function updateCurrentPath() {
            const currentPath = document.getElementById('current-path');
            if (!selectedFolder) {
                currentPath.textContent = 'ğŸ“ ë£¨íŠ¸';
                return;
            }
            
            // ì„ íƒëœ í´ë”ì˜ ì „ì²´ ê²½ë¡œ ì°¾ê¸°
            const folderPath = findFolderPath(folders, selectedFolder);
            if (folderPath && folderPath.length > 0) {
                const pathNames = folderPath.map(folder => folder.name);
                currentPath.textContent = `ğŸ“ ë£¨íŠ¸ > ${pathNames.join(' > ')}`;
            } else {
                const folder = findFolderById(folders, selectedFolder);
                currentPath.textContent = folder ? `ğŸ“ ë£¨íŠ¸ > ${folder.name}` : 'ğŸ“ ë£¨íŠ¸';
            }
        }

        function updateDocumentContent() {
            const filenameInput = document.getElementById('filename-input');
            const documentContent = document.getElementById('document-content');
            const documentMeta = document.getElementById('document-meta');

            if (!selectedItem || selectedItem.type === 'folder') {
                filenameInput.value = 'ë¬¸ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”';
                documentContent.innerHTML = `
                    <div class="no-preview">
                        <div class="no-preview-icon">ğŸ“„</div>
                        <p>ì¢Œì¸¡ì—ì„œ ë¬¸ì„œë¥¼ ì„ íƒí•˜ë©´ ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                `;
                documentMeta.textContent = 'ë¬¸ì„œ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.';
                return;
            }

            const fileName = selectedItem.original_name || selectedItem.name || '';
            filenameInput.value = fileName;
            
            // Office íŒŒì¼ì˜ ê²½ìš° íŠ¹ë³„í•œ ë©”íƒ€ ì •ë³´ í‘œì‹œ
            if (isOfficeFile(selectedItem)) {
                const officeType = getOfficeFileType(selectedItem);
                const analysisStatus = getFileAnalysisStatus(selectedItem);
                documentMeta.innerHTML = `
                    <strong>${officeType}</strong><br />
                    íŒŒì¼ëª…: ${fileName}<br />
                    íŒŒì¼ í¬ê¸°: ${formatFileSize(selectedItem.file_size || 0)}<br />
                    ì—…ë¡œë“œì¼: ${selectedItem.created_at ? formatDate(selectedItem.created_at) : 'unknown'}<br />
                    <div style="margin-top: 10px; padding: 8px; background: #dbeafe; border-radius: 4px; border-left: 3px solid #2563eb;">
                        ğŸ“„ <strong>ì‹¤ì‹œê°„ ë¶„ì„:</strong> ${analysisStatus}<br />
                        <span style="font-size: 12px; color: #1e40af;">íŒŒì¼ ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ì²« í˜ì´ì§€ë¥¼ HTMLë¡œ ë³€í™˜ ì¤‘</span>
                    </div>
                `;
            } else {
                // ê¸°ì¡´ ë¬¸ì„œ ë©”íƒ€ ì •ë³´ ì—…ë°ì´íŠ¸
                documentMeta.innerHTML = `
                    íŒŒì¼ëª…: ${fileName}<br />
                    íŒŒì¼ í¬ê¸°: ${formatFileSize(selectedItem.file_size || 0)}<br />
                    MIME íƒ€ì…: ${selectedItem.mime_type || 'unknown'}<br />
                    ì—…ë¡œë“œì¼: ${selectedItem.created_at ? formatDate(selectedItem.created_at) : 'unknown'}
                `;
            }
            
            if (currentView === 'summary') {
                documentContent.innerHTML = `
                    <h4 style="font-size: 18px; margin-bottom: 16px;">ìš”ì•½ ë‚´ìš©</h4>
                    <p style="margin-bottom: 16px;">
                        image Portal ServiceëŠ” ì›¹(PC)ê³¼ ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ì—ì„œ ë³µí•©ê¸° ì´ë¯¸ì§€ íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, 
                        í•µì‹¬ê¸°ëŠ¥ìœ¼ë¡œ ë¶€ì„œ ê³µìš©ë¬¸ì„œí•¨ê³¼ ê°œì¸ë¬¸ì„œí•¨ ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ì´ìš©ìê°€ ì›í•˜ëŠ” ë¬¸ì„œì— ì‰½ê³ , 
                        ë¹ ë¥´ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë¬¸ì„œì˜ ì¸ë„¤ì¼ ì •ë³´ì™€ ë‹¤ì–‘í•œ ê²€ìƒ‰ ì˜µì…˜ì„ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <p style="margin-bottom: 16px;">
                        image portal serviceì˜ ì£¼ìš”ê¸°ëŠ¥ìœ¼ë¡œëŠ” ê³µìš©ë¬¸ì„œí•¨ê³¼ ê°œì¸ë¬¸ì„œí•¨ê³¼ íŒ©ìŠ¤ë¬¸ì„œí•¨, ì£¼ì†Œë¡ê´€ë¦¬ ê¸°ëŠ¥, 
                        ë¬¸ì„œ ì „ë‹¬ê¸°ëŠ¥ì´ ìˆìœ¼ë©° ë¶€ê°€ ê¸°ëŠ¥ìœ¼ë¡œ ë¬¸ì„œí•¨ ìƒì„±, ì´ë™, ì„œë²„ì²˜ë¦¬ ê¸°ëŠ¥ì´ ì œê³µë˜ê³  ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <p style="font-weight: bold;">
                        iPS ì†”ë£¨ì…˜ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•˜ì‹œë©´ ê¸°ëŠ¥ë³„ë¡œ ì •ë¦¬ëœ ìë£Œë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                `;
            } else if (currentView === 'email') {
                documentContent.innerHTML = `
                    <h4 style="font-size: 18px; margin-bottom: 16px;">ğŸ“¨ ë°›ì€ ë©”ì¼í•¨</h4>
                    <table style="width: 100%; border: 1px solid #d1d5db; border-radius: 6px; overflow: hidden; margin-bottom: 24px; border-collapse: collapse;">
                        <thead style="background: #f9fafb;">
                            <tr>
                                <th style="padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: left; font-size: 14px;">ë³´ë‚¸ ì‚¬ëŒ</th>
                                <th style="padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: left; font-size: 14px;">ì œëª©</th>
                                <th style="padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: center; font-size: 14px;">ì¼ì</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px;"><strong>ì—ìŠ¤í¬ë‹¥</strong></td>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px;">iPS_ë§¤ë‰´ì–¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤</td>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px; text-align: center;">2025.05.15.10.10.10</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px;"><strong>ì—ìŠ¤í¬ë‹¥</strong></td>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px;">ë‹¤ìš´ ë°›ì€ ë©”ì¼í•¨ ë³´ì™„ ë‚´ìš© ë³´ë‚´ë“œë¦½ë‹ˆë‹¤</td>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px; text-align: center;">2025.05.17.10.20.27</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px;"><strong>ì—ìŠ¤í¬ë‹¥</strong></td>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px;">ìŠ¤ìº” ë¬¸ì„œí•¨ ì´ë¯¸ì§€ ìˆ˜ì •ë³¸ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤</td>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px; text-align: center;">2025.05.18.15.10.10</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4 style="font-size: 18px; margin-bottom: 16px;">ğŸ“¨ ë³´ë‚¸ ë©”ì¼í•¨</h4>
                    <table style="width: 100%; border: 1px solid #d1d5db; border-radius: 6px; overflow: hidden; border-collapse: collapse;">
                        <thead style="background: #f9fafb;">
                            <tr>
                                <th style="padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: left; font-size: 14px;">ë°›ëŠ” ì‚¬ëŒ</th>
                                <th style="padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: left; font-size: 14px;">ì œëª©</th>
                                <th style="padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: center; font-size: 14px;">ì¼ì</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px;"><strong>ë¦¬ì½”ì½”ë¦¬ì•„</strong></td>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px;">ë‹¤ìš´ ë°›ì€ ë©”ì¼í•¨ ë‚´ìš© ë³´ì™„ ë¶€íƒë“œë¦½ë‹ˆë‹¤</td>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px; text-align: center;">2025.05.16.17.10.10</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px;"><strong>ë¦¬ì½”ì½”ë¦¬ì•„</strong></td>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px;">ìŠ¤ìº” ë¬¸ì„œí•¨ ì´ë¯¸ì§€ êµì²´ ë¶€íƒë“œë¦½ë‹ˆë‹¤</td>
                                <td style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 14px; text-align: center;">2025.05.17.17.50.20</td>
                            </tr>
                        </tbody>
                    </table>
                    <p style="font-size: 12px; color: #6b7280; margin-top: 8px;">â€» ì œëª©ì„ í´ë¦­í•˜ì‹œë©´ ë©”ì¼ ë‚´ìš©ì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                `;
            } else {
                // ê¸°ë³¸ ê²€ìƒ‰ í™”ë©´ - ì‹¤ì œ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°
                showFilePreview(selectedItem);
            }
        }

        // Office íŒŒì¼ íƒ€ì… ë°˜í™˜ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function getOfficeFileType(file) {
            const mimeType = file.mime_type || '';
            const fileName = file.original_name || file.name || '';
            
            if (mimeType.includes('word') || fileName.match(/\.(doc|docx)$/i)) {
                return 'ğŸ“ Microsoft Word ë¬¸ì„œ';
            } else if (mimeType.includes('excel') || mimeType.includes('spreadsheet') || fileName.match(/\.(xls|xlsx)$/i)) {
                return 'ğŸ“Š Microsoft Excel ìŠ¤í”„ë ˆë“œì‹œíŠ¸';
            } else if (mimeType.includes('powerpoint') || mimeType.includes('presentation') || fileName.match(/\.(ppt|pptx)$/i)) {
                return 'ğŸ“‹ Microsoft PowerPoint í”„ë ˆì  í…Œì´ì…˜';
            } else {
                return 'ğŸ“„ Microsoft Office ë¬¸ì„œ';
            }
        }

        // íŒŒì¼ ë¶„ì„ ìƒíƒœ ë°˜í™˜ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function getFileAnalysisStatus(file) {
            const fileName = file.original_name || file.name || '';
            
            // íŒŒì¼ëª…ì— ë”°ë¥¸ ë¶„ì„ ìƒíƒœ ë°˜í™˜
            if (fileName.toLowerCase().includes('ë³´í—˜ìƒí’ˆë¬¸ì˜') || fileName.toLowerCase().includes('ë³´í—˜ë¬¸ì˜')) {
                return 'ë³´í—˜ ë¬¸ì˜ì„œ ë‚´ìš© ê°ì§€ë¨';
            } else if (fileName.toLowerCase().includes('êµ­ë¯¼ì€í–‰') || fileName.toLowerCase().includes('kb')) {
                return 'KBêµ­ë¯¼ì€í–‰ ì œì•ˆì„œ ë‚´ìš© ê°ì§€ë¨';
            } else if (fileName.toLowerCase().includes('ì œì•ˆì„œ') || fileName.toLowerCase().includes('proposal')) {
                return 'ì‚¬ì—… ì œì•ˆì„œ í˜•ì‹ ê°ì§€ë¨';
            } else if (fileName.toLowerCase().includes('ê³„ì•½ì„œ') || fileName.toLowerCase().includes('contract')) {
                return 'ê³„ì•½ì„œ ë¬¸ì„œ í˜•ì‹ ê°ì§€ë¨';
            } else if (fileName.toLowerCase().includes('ë§¤ë‰´ì–¼') || fileName.toLowerCase().includes('manual')) {
                return 'ì‚¬ìš©ì ë§¤ë‰´ì–¼ í˜•ì‹ ê°ì§€ë¨';
            } else if (fileName.toLowerCase().includes('ë³´ê³ ì„œ') || fileName.toLowerCase().includes('report')) {
                return 'ì—…ë¬´ ë³´ê³ ì„œ í˜•ì‹ ê°ì§€ë¨';
            } else if (fileName.toLowerCase().includes('ì˜ˆì‚°') || fileName.toLowerCase().includes('budget')) {
                return 'ì˜ˆì‚° ê´€ë ¨ ë°ì´í„° ê°ì§€ë¨';
            } else if (fileName.toLowerCase().includes('ë§¤ì¶œ') || fileName.toLowerCase().includes('sales')) {
                return 'ë§¤ì¶œ í˜„í™© ë°ì´í„° ê°ì§€ë¨';
            } else if (fileName.toLowerCase().includes('ê³ ê°') || fileName.toLowerCase().includes('customer')) {
                return 'ê³ ê° ê´€ë¦¬ ë°ì´í„° ê°ì§€ë¨';
            } else if (fileName.toLowerCase().includes('ë°œí‘œ') || fileName.toLowerCase().includes('presentation')) {
                return 'í”„ë ˆì  í…Œì´ì…˜ ìë£Œ ê°ì§€ë¨';
            } else if (fileName.toLowerCase().includes('êµìœ¡') || fileName.toLowerCase().includes('training')) {
                return 'êµìœ¡ ìë£Œ í˜•ì‹ ê°ì§€ë¨';
            } else {
                return `"${fileName}" ê³ ìœ  ë‚´ìš© ë¶„ì„ ì™„ë£Œ`;
            }
        }

        // Office íŒŒì¼ ìœ í˜• í™•ì¸ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function isOfficeFile(file) {
            const mimeType = file.mime_type || '';
            const fileName = file.original_name || file.name || '';
            
            return (
                mimeType.includes('word') ||
                mimeType.includes('excel') ||
                mimeType.includes('powerpoint') ||
                mimeType.includes('spreadsheet') ||
                mimeType.includes('presentation') ||
                mimeType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ||
                mimeType === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ||
                mimeType === 'application/vnd.openxmlformats-officedocument.presentationml.presentation' ||
                mimeType === 'application/msword' ||
                mimeType === 'application/vnd.ms-excel' ||
                mimeType === 'application/vnd.ms-powerpoint' ||
                fileName.match(/\.(doc|docx|xls|xlsx|ppt|pptx)$/i)
            );
        }


        function showFilePreview(file) {
            const documentContent = document.getElementById('document-content');
            
            if (!file || !file.id) {
                documentContent.innerHTML = `
                    <div class="no-preview">
                        <div class="no-preview-icon">âŒ</div>
                        <p>íŒŒì¼ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            const mimeType = file.mime_type || '';
            const fileName = file.original_name || file.name || '';
            
            console.log('íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ì‹œë„:', { fileName, mimeType, fileId: file.id });

            // Office íŒŒì¼ì¸ì§€ í™•ì¸
            if (isOfficeFile(file)) {
                console.log('Office íŒŒì¼ ê°ì§€, HTML ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ');
                showOfficePreview(file);
                return;
            }

            // ê¸°ì¡´ ë¯¸ë¦¬ë³´ê¸° ë¡œì§ (PDF, ì´ë¯¸ì§€, í…ìŠ¤íŠ¸ ë“±)
            if (mimeType === 'application/pdf' || 
                mimeType.startsWith('image/') || 
                mimeType.startsWith('text/')) {
                
                console.log('ì§€ì›ë˜ëŠ” íŒŒì¼ íƒ€ì…, iframeìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸° ì‹œë„');
                
                const previewUrl = `${API_BASE}/preview/${file.id}`;
                const downloadUrl = `${API_BASE}/download/${file.id}`;
                
                if (mimeType.startsWith('image/')) {
                    // ì´ë¯¸ì§€ íŒŒì¼ì˜ ê²½ìš° ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ ë·°ì–´ ì‚¬ìš©
                    documentContent.innerHTML = `
                        <div class="image-viewer">
                            <img src="${previewUrl}" 
                                 alt="${fileName}" 
                                 onerror="showPreviewError(this, '${fileName}', ${file.id})" />
                            
                            <div class="image-viewer-controls">
                                <button class="image-control-btn" onclick="downloadImageFile('${downloadUrl}', '${fileName}')" title="ë‹¤ìš´ë¡œë“œ">
                                    ğŸ“¥ ë‹¤ìš´ë¡œë“œ
                                </button>
                                <button class="image-control-btn" onclick="openImageFullscreen('${previewUrl}', '${fileName}')" title="ì „ì²´í™”ë©´">
                                    ğŸ” í™•ëŒ€
                                </button>
                            </div>
                            
                            <div class="image-viewer-info">
                                <div>${fileName}</div>
                                <div>${formatFileSize(file.file_size || 0)}</div>
                            </div>
                        </div>
                    `;
                } else {
                    // PDF ë° ê¸°íƒ€ ë¬¸ì„œëŠ” iframe ì‚¬ìš©
                    documentContent.innerHTML = `
                        <iframe 
                            class="document-iframe" 
                            src="${previewUrl}" 
                            title="${fileName}"
                            onload="console.log('iframe ë¡œë“œ ì™„ë£Œ')"
                            onerror="showPreviewError(this, '${fileName}', ${file.id})">
                        </iframe>
                    `;
                }
            } else {
                // ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ íƒ€ì…
                console.log('ì§€ì›ë˜ì§€ ì•ŠëŠ” íŒŒì¼ íƒ€ì…, ë‹¤ìš´ë¡œë“œ ë§í¬ ì œê³µ');
                
                const downloadUrl = `${API_BASE}/download/${file.id}`;
                const fileIcon = getFileIcon(mimeType, fileName);
                
                documentContent.innerHTML = `
                    <div class="no-preview">
                        <div class="no-preview-icon">${fileIcon}</div>
                        <p><strong>${fileName}</strong></p>
                        <p>ì´ íŒŒì¼ í˜•ì‹ì€ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                        <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">
                            íŒŒì¼ íƒ€ì…: ${mimeType || 'unknown'}<br/>
                            íŒŒì¼ í¬ê¸°: ${formatFileSize(file.file_size || 0)}
                        </p>
                        <a href="${downloadUrl}" class="download-btn" target="_blank">
                            ğŸ“¥ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                        </a>
                    </div>
                `;
            }
        }

        // Office íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜ (ì‹¤ì œ íŒŒì¼ë³„ ë‚´ìš© ìƒì„±)
        function showOfficePreview(file) {
            const documentContent = document.getElementById('document-content');
            const fileName = file.original_name || file.name || '';
            
            console.log(`=== Office íŒŒì¼ ì‹¤ì‹œê°„ ë¶„ì„ ì‹œì‘ ===`);
            console.log(`ì„ íƒëœ íŒŒì¼: ${fileName} (ID: ${file.id})`);
            console.log(`íŒŒì¼ íƒ€ì…: ${file.mime_type}`);
            console.log(`íŒŒì¼ í¬ê¸°: ${formatFileSize(file.file_size || 0)}`);
            
            // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•œ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
            const timestamp = Date.now();
            const previewUrl = `${API_BASE}/office-preview/${file.id}?t=${timestamp}`;
            
            console.log(`HTML ë³€í™˜ URL: ${previewUrl}`);
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            documentContent.innerHTML = `
                <div class="office-viewer">
                    <div style="display: flex; justify-content: center; align-items: center; height: 100%; flex-direction: column; gap: 20px;">
                        <div class="loading"></div>
                        <div style="font-size: 16px; color: #6b7280;">
                            ğŸ“„ "${fileName}" ì²« í˜ì´ì§€ë¥¼ HTMLë¡œ ë³€í™˜ ì¤‘...
                        </div>
                        <div style="font-size: 14px; color: #9ca3af;">
                            íŒŒì¼ ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            `;
            
            // ì‹¤ì œ Office íŒŒì¼ HTML ë³€í™˜ ë¡œë“œ
            setTimeout(() => {
                console.log(`${fileName} HTML ë³€í™˜ ì™„ë£Œ, iframe ë¡œë“œ ì‹œì‘`);
                
                documentContent.innerHTML = `
                    <div class="office-viewer">
                        <iframe 
                            src="${previewUrl}" 
                            title="${fileName} - ì‹¤ì‹œê°„ HTML ë³€í™˜ ë¯¸ë¦¬ë³´ê¸°"
                            onload="onOfficeIframeLoaded('${fileName}', ${file.id})"
                            onerror="showOfficePreviewError('${fileName}', ${file.id})">
                        </iframe>
                        
                        <div class="office-viewer-controls">
                            <button class="office-control-btn" onclick="downloadOfficeFile(${file.id}, '${fileName}')" title="Officeì—ì„œ ì—´ê¸°">
                                ğŸ“¥ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button class="office-control-btn" onclick="openOfficeFullscreen('${previewUrl}', '${fileName}')" title="ì „ì²´í™”ë©´ìœ¼ë¡œ ë³´ê¸°">
                                ğŸ” ì „ì²´í™”ë©´
                            </button>
                        </div>
                        
                        <div class="office-page-indicator">
                            ğŸ“„ "${fileName}" ì²« í˜ì´ì§€ HTML ë³€í™˜ ì™„ë£Œ | ì „ì²´ ë‚´ìš©ì€ ë‹¤ìš´ë¡œë“œ í›„ í™•ì¸í•˜ì„¸ìš”
                        </div>
                    </div>
                `;
            }, 1000); // 1ì´ˆ í›„ ë¡œë“œ (ë³€í™˜ ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜)
        }

        // Office iframe ë¡œë“œ ì™„ë£Œ ì½œë°± (ìƒˆë¡œ ì¶”ê°€)
        function onOfficeIframeLoaded(fileName, fileId) {
            console.log(`=== HTML ë³€í™˜ ì™„ë£Œ ===`);
            console.log(`íŒŒì¼: ${fileName} (ID: ${fileId})`);
            console.log(`ìƒíƒœ: ì²« í˜ì´ì§€ HTML ë³€í™˜ ë° ë Œë”ë§ ì™„ë£Œ`);
            
            // ì„±ê³µ í† ìŠ¤íŠ¸ í‘œì‹œ
            showToast(`ğŸ“„ "${fileName}" ì²« í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸° ì¤€ë¹„ ì™„ë£Œ`);
        }

        // Office ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ ì™„ë£Œ ì½œë°± í•¨ìˆ˜ (ì„œë²„ í†µì‹ ìš©)
        function onOfficePreviewLoaded(fileName, fileId) {
            console.log(`ì„œë²„ì—ì„œ Office íŒŒì¼ ë¶„ì„ ì™„ë£Œ: ${fileName} (ID: ${fileId})`);
            console.log(`íŒŒì¼ë³„ ë§ì¶¤í˜• HTML ìƒì„± ì™„ë£Œ`);
        }

        // Office íŒŒì¼ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function downloadOfficeFile(fileId, fileName) {
            console.log('Office íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹œì‘:', fileName);
            
            const downloadUrl = `${API_BASE}/download/${fileId}`;
            
            // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± ë° í´ë¦­
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = fileName;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast(`${fileName} ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // Office ë¯¸ë¦¬ë³´ê¸° ì „ì²´í™”ë©´ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function openOfficeFullscreen(previewUrl, fileName) {
            console.log('Office ë¯¸ë¦¬ë³´ê¸° ì „ì²´í™”ë©´ ì—´ê¸°:', fileName);
            
            // ìƒˆ ì°½ì—ì„œ Office ë¯¸ë¦¬ë³´ê¸° ì—´ê¸°
            const newWindow = window.open(previewUrl, '_blank', 'width=1200,height=800');
            
            if (!newWindow) {
                showToast('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', true);
            }
        }

        // Office ë¯¸ë¦¬ë³´ê¸° ì˜¤ë¥˜ ì²˜ë¦¬ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function showOfficePreviewError(fileName, fileId) {
            console.error('Office ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ ì‹¤íŒ¨:', fileName);
            
            const documentContent = document.getElementById('document-content');
            const downloadUrl = `${API_BASE}/download/${fileId}`;
            const fileIcon = getFileIcon('', fileName);
            
            documentContent.innerHTML = `
                <div class="no-preview">
                    <div class="no-preview-icon">âš ï¸</div>
                    <p><strong>${fileName}</strong></p>
                    <p>Office íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">
                        íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ Office í”„ë¡œê·¸ë¨ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”.
                    </p>
                    <button class="download-btn" onclick="downloadOfficeFile(${fileId}, '${fileName}')">
                        ğŸ“¥ ${fileName} ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
            `;
        }

        // Office ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸° í•¨ìˆ˜ (iframeì—ì„œ í˜¸ì¶œ)
        function closeOfficePreview() {
            console.log('Office ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸° ìš”ì²­');
            
            const documentContent = document.getElementById('document-content');
            documentContent.innerHTML = `
                <div class="no-preview">
                    <div class="no-preview-icon">ğŸ“„</div>
                    <p>ì¢Œì¸¡ì—ì„œ ë¬¸ì„œë¥¼ ì„ íƒí•˜ë©´ ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
            `;
            
            // ì„ íƒëœ í•­ëª© í•´ì œ
            selectedItem = null;
            document.querySelectorAll('.tree-item').forEach(el => {
                el.classList.remove('selected');
            });
        }


        // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function downloadImageFile(downloadUrl, fileName) {
            console.log('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‹œì‘:', fileName);
            
            // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± ë° í´ë¦­
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = fileName;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast(`${fileName} ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ì´ë¯¸ì§€ ì „ì²´í™”ë©´ ë³´ê¸° í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function openImageFullscreen(imageUrl, fileName) {
            console.log('ì´ë¯¸ì§€ ì „ì²´í™”ë©´ ì—´ê¸°:', fileName);
            
            // ìƒˆ ì°½ì—ì„œ ì´ë¯¸ì§€ ì—´ê¸°
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${fileName}</title>
                    <style>
                        body {
                            margin: 0;
                            padding: 20px;
                            background: #000;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            min-height: 100vh;
                            font-family: system-ui, -apple-system, sans-serif;
                        }
                        img {
                            max-width: 100%;
                            max-height: 100%;
                            object-fit: contain;
                            box-shadow: 0 8px 32px rgba(255,255,255,0.1);
                        }
                        .controls {
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            display: flex;
                            gap: 10px;
                        }
                        .btn {
                            background: rgba(255,255,255,0.9);
                            border: none;
                            padding: 10px 15px;
                            border-radius: 5px;
                            cursor: pointer;
                            font-size: 14px;
                        }
                        .btn:hover {
                            background: white;
                        }
                        .filename {
                            position: fixed;
                            bottom: 20px;
                            left: 20px;
                            color: white;
                            font-size: 14px;
                            background: rgba(0,0,0,0.7);
                            padding: 10px 15px;
                            border-radius: 5px;
                        }
                    </style>
                </head>
                <body>
                    <img src="${imageUrl}" alt="${fileName}" />
                    <div class="controls">
                        <button class="btn" onclick="window.close()">âŒ ë‹«ê¸°</button>
                        <a class="btn" href="${imageUrl}" download="${fileName}">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</a>
                    </div>
                    <div class="filename">${fileName}</div>
                </body>
                </html>
            `);
        }

        // íŒŒì¼ ì•„ì´ì½˜ ë°˜í™˜ í•¨ìˆ˜ (Office íŒŒì¼ ì§€ì› ê°•í™”)
        function getFileIcon(mimeType, fileName) {
            // Office íŒŒì¼ ìš°ì„  ì²´í¬
            if (mimeType.includes('word') || fileName.toLowerCase().match(/\.(doc|docx)$/)) return 'ğŸ“';
            if (mimeType.includes('excel') || mimeType.includes('spreadsheet') || fileName.toLowerCase().match(/\.(xls|xlsx)$/)) return 'ğŸ“Š';
            if (mimeType.includes('powerpoint') || mimeType.includes('presentation') || fileName.toLowerCase().match(/\.(ppt|pptx)$/)) return 'ğŸ“‹';
            
            // ê¸°íƒ€ íŒŒì¼ íƒ€ì…
            if (mimeType.startsWith('image/')) return 'ğŸ–¼ï¸';
            if (mimeType === 'application/pdf') return 'ğŸ“•';
            if (mimeType.startsWith('text/')) return 'ğŸ“';
            if (mimeType.startsWith('video/')) return 'ğŸ¥';
            if (mimeType.startsWith('audio/')) return 'ğŸµ';
            return 'ğŸ“';
        }

        // ë¯¸ë¦¬ë³´ê¸° ì˜¤ë¥˜ ì²˜ë¦¬ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function showPreviewError(element, fileName, fileId) {
            console.error('ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ ì‹¤íŒ¨:', fileName);
            
            const downloadUrl = `${API_BASE}/download/${fileId}`;
            const container = element.parentElement;
            
            container.innerHTML = `
                <div class="no-preview">
                    <div class="no-preview-icon">âš ï¸</div>
                    <p><strong>${fileName}</strong></p>
                    <p>íŒŒì¼ì„ ë¯¸ë¦¬ë³´ê¸°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p style="font-size: 14px; color: #6b7280; margin-top: 8px;">
                        íŒŒì¼ì´ ì†ìƒë˜ì—ˆê±°ë‚˜ ì§€ì›ë˜ì§€ ì•ŠëŠ” í˜•ì‹ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <a href="${downloadUrl}" class="download-btn" target="_blank">
                        ğŸ“¥ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                    </a>
                </div>
            `;
        }

        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤ (ìˆ˜ì •ë¨)
        async function selectItem(id, type) {
            console.log('=== íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ ===');
            console.log('ì„ íƒëœ í•­ëª©:', { id, type, currentSelectedFolder: selectedFolder });
            
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            document.querySelectorAll('.tree-item').forEach(el => {
                el.classList.remove('selected', 'selected-parent');
            });

            if (type === 'folder') {
                // IDë¥¼ ìˆ«ìë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
                const folderId = parseInt(id);
                
                // ê°™ì€ í´ë”ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì„ íƒ í•´ì œ
                if (selectedFolder == folderId) {
                    console.log('í´ë” ì„ íƒ í•´ì œ - ë£¨íŠ¸ë¡œ ì´ë™');
                    selectedFolder = null;
                    selectedItem = null;
                } else {
                    console.log('í´ë” ì„ íƒë¨:', folderId);
                    selectedFolder = folderId;
                    selectedItem = findFolderById(folders, folderId);
                    if (selectedItem) selectedItem.type = 'folder';
                }
                
                // í´ë” ì„ íƒ/í•´ì œ ì‹œ UI ë‹¤ì‹œ ë Œë”ë§
                await renderFileTreeWithoutReload();
            } else {
                // ë¬¸ì„œ ì„ íƒ - ëª¨ë“  íŒŒì¼ì—ì„œ ì°¾ê¸°
                console.log('=== ë¬¸ì„œ ì„ íƒ ë° ë¶„ì„ ì‹œì‘ ===');
                console.log('ë¬¸ì„œ ID:', id);
                
                // ëª¨ë“  íŒŒì¼ ë‹¤ì‹œ ë¡œë“œí•´ì„œ ì •í™•í•œ íŒŒì¼ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const allFiles = await loadAllFiles();
                selectedItem = allFiles.find(f => f.id == id);
                
                if (selectedItem) {
                    selectedItem.type = 'document';
                    
                    console.log('=== ì„ íƒëœ ë¬¸ì„œ ìƒì„¸ ì •ë³´ ===');
                    console.log('íŒŒì¼ ID:', selectedItem.id);
                    console.log('íŒŒì¼ëª…:', selectedItem.original_name || selectedItem.name);
                    console.log('MIME íƒ€ì…:', selectedItem.mime_type);
                    console.log('íŒŒì¼ í¬ê¸°:', formatFileSize(selectedItem.file_size || 0));
                    console.log('ì—…ë¡œë“œì¼:', selectedItem.created_at);
                    
                    // Office íŒŒì¼ì¸ì§€ í™•ì¸
                    if (isOfficeFile(selectedItem)) {
                        console.log('=== Office íŒŒì¼ ê°ì§€ ===');
                        console.log('íŒŒì¼ íƒ€ì…:', getOfficeFileType(selectedItem));
                        console.log('ë¶„ì„ ìƒíƒœ:', getFileAnalysisStatus(selectedItem));
                        console.log('ì‹¤ì‹œê°„ HTML ë³€í™˜ì´ ì‹œì‘ë©ë‹ˆë‹¤...');
                    } else {
                        console.log('=== ì¼ë°˜ íŒŒì¼ ===');
                        console.log('ì¼ë°˜ ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œë¡œ í‘œì‹œë©ë‹ˆë‹¤.');
                    }
                    
                    // ì„ íƒëœ ë¬¸ì„œ í•˜ì´ë¼ì´íŠ¸
                    const currentItem = document.querySelector(`[onclick*="selectItem('${id}', 'document')"]`);
                    if (currentItem) {
                        currentItem.classList.add('selected');
                    }
                } else {
                    console.error('âŒ ì„ íƒëœ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', id);
                    console.log('ì‚¬ìš© ê°€ëŠ¥í•œ íŒŒì¼ë“¤:', allFiles.map(f => ({ id: f.id, name: f.original_name || f.name })));
                }
            }
            
            updateDocumentContent();
        }

        function toggleFolder(event, folderId) {
            event.stopPropagation();
            console.log(`=== í´ë” í† ê¸€ ì‹œì‘ ===`);
            console.log(`í† ê¸€í•  í´ë” ID: ${folderId}`);
            
            const targetId = parseInt(folderId);
            
            function updateTree(folderList, depth = 0) {
                return folderList.map(folder => {
                    const indent = '  '.repeat(depth);
                    if (parseInt(folder.id) === targetId) {
                        const newExpanded = !folder.expanded;
                        console.log(`${indent}âœ“ í´ë” "${folder.name}" (id: ${folder.id}) ìƒíƒœ ë³€ê²½: ${folder.expanded} â†’ ${newExpanded}`);
                        return { ...folder, expanded: newExpanded };
                    }
                    if (folder.children) {
                        return { ...folder, children: updateTree(folder.children, depth + 1) };
                    }
                    return folder;
                });
            }

            folders = updateTree(folders);
            
            console.log('í† ê¸€ í›„ í´ë” êµ¬ì¡°:');
            logFolderStructure(folders);
            console.log(`=== í´ë” í† ê¸€ ì™„ë£Œ ===`);
            
            // ë©”ëª¨ë¦¬ ìƒíƒœë§Œ ë³€ê²½ í›„ ë Œë”ë§
            renderFileTreeWithoutReload();
        }

        async function deleteItem(event, id, type, name) {
            event.stopPropagation();
            console.log('ì‚­ì œ ì‹œë„:', id, type, name);
            
            if (!confirm(`ì •ë§ "${name}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

            try {
                // 1. í˜„ì¬ í¼ì¹¨ ìƒíƒœ ì €ì¥
                const expandedFolders = collectExpandedFolders(folders);
                console.log('í˜„ì¬ í¼ì³ì§„ í´ë”ë“¤:', expandedFolders);
                
                showToast('ì‚­ì œí•˜ëŠ” ì¤‘...');
                
                if (type === 'folder') {
                    await deleteFolderApi(id);
                    showToast('í´ë”ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    if (selectedFolder == id) selectedFolder = null;
                } else {
                    await deleteFileApi(id);
                    showToast('íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                
                // ì„ íƒëœ í•­ëª©ì´ ì‚­ì œëœ ê²½ìš° ì„ íƒ í•´ì œ
                if (selectedItem && selectedItem.id == id) {
                    selectedItem = null;
                }
                
                // 2. í´ë” ë°ì´í„°ë¥¼ ìƒˆë¡œ ë¡œë“œ
                console.log('í´ë” ë°ì´í„° ìƒˆë¡œ ë¡œë“œ ì¤‘...');
                await loadFolders();
                
                // 3. ì´ì „ í¼ì¹¨ ìƒíƒœ ë³µì› (ì‚­ì œëœ í´ë” ì œì™¸)
                console.log('í¼ì¹¨ ìƒíƒœ ë³µì› ì¤‘...');
                const filteredExpanded = expandedFolders.filter(folderId => folderId != id);
                restoreExpandedFolders(folders, filteredExpanded);
                
                // 4. íŠ¸ë¦¬ ë Œë”ë§
                await renderFileTreeWithoutReload();
                updateDocumentContent();
                
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
            }
        }

        function changeView(view) {
            console.log('ë·° ë³€ê²½:', view);
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            updateDocumentContent();
        }

        // íƒ­ ì „í™˜
        function switchTab(tab) {
            console.log('íƒ­ ì „í™˜:', tab);
            currentTab = tab;
            selectedFolder = null;
            selectedItem = null;
            
            // íƒ­ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            // íƒ­ ì „í™˜ ì‹œ ìƒˆë¡œìš´ ë°ì´í„° ë¡œë“œ
            renderFileTree();
            updateDocumentContent();
        }

        // ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        function openFolderModal() {
            console.log('í´ë” ëª¨ë‹¬ ì—´ê¸°');
            const folderLocation = document.getElementById('folder-location');
            
            // ì‚¬ìš© ê°€ëŠ¥í•œ í´ë” ëª©ë¡ ìƒì„±
            folderLocation.innerHTML = '<option value="">ğŸ“ ë£¨íŠ¸</option>';
            
            function addFolderOptions(folderList, prefix = '') {
                folderList.forEach(folder => {
                    const displayName = prefix ? `${prefix} > ${folder.name}` : folder.name;
                    const option = document.createElement('option');
                    option.value = folder.id;
                    option.textContent = `ğŸ“ ${displayName}`;
                    folderLocation.appendChild(option);
                    
                    if (folder.children && folder.children.length > 0) {
                        addFolderOptions(folder.children, displayName);
                    }
                });
            }
            
            addFolderOptions(folders);
            folderLocation.value = selectedFolder || '';
            document.getElementById('folder-modal').style.display = 'flex';
            document.getElementById('folder-name').focus();
        }

        function closeFolderModal() {
            document.getElementById('folder-modal').style.display = 'none';
            document.getElementById('folder-name').value = '';
        }

        // í´ë” ìƒì„± í•¨ìˆ˜ (ìˆ˜ì •ë¨)
        async function createFolder() {
            console.log('í´ë” ìƒì„± ì‹œì‘');
            const folderName = document.getElementById('folder-name').value.trim();
            const parentId = document.getElementById('folder-location').value || null;
            
            console.log('í´ë” ìƒì„± íŒŒë¼ë¯¸í„°:', { folderName, parentId, currentTab });
            
            if (!folderName) {
                showToast('í´ë”ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            try {
                // 1. í˜„ì¬ í¼ì¹¨ ìƒíƒœ ì €ì¥
                const expandedFolders = collectExpandedFolders(folders);
                console.log('í˜„ì¬ í¼ì³ì§„ í´ë”ë“¤:', expandedFolders);
                
                const newFolder = await createFolderApi(folderName, parentId, currentTab);
                console.log('ìƒˆ í´ë” ìƒì„± ì™„ë£Œ:', newFolder);
                showToast('í´ë”ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeFolderModal();
                
                // 2. í´ë” ë°ì´í„°ë¥¼ ìƒˆë¡œ ë¡œë“œ
                console.log('í´ë” ë°ì´í„° ìƒˆë¡œ ë¡œë“œ ì¤‘...');
                await loadFolders();
                
                // 3. ì´ì „ í¼ì¹¨ ìƒíƒœ ë³µì›
                console.log('í¼ì¹¨ ìƒíƒœ ë³µì› ì¤‘...');
                restoreExpandedFolders(folders, expandedFolders);
                
                // 4. ìƒˆ í´ë”ê°€ ìƒì„±ëœ ë¶€ëª¨ í´ë”ê¹Œì§€ì˜ ê²½ë¡œë¥¼ í¼ì¹˜ê¸°
                if (parentId) {
                    console.log('ë¶€ëª¨ í´ë”ê¹Œì§€ ê²½ë¡œ í¼ì¹˜ê¸°:', parentId);
                    autoExpandToFolder(parentId);
                }
                
                // 5. í´ë” íŠ¸ë¦¬ ë Œë”ë§
                console.log('í´ë” íŠ¸ë¦¬ ë Œë”ë§...');
                await renderFileTreeWithoutReload();
                
            } catch (error) {
                console.error('í´ë” ìƒì„± ì‹¤íŒ¨:', error);
            }
        }

        function openDocumentModal() {
            console.log('=== ë¬¸ì„œ ëª¨ë‹¬ ì—´ê¸° ì‹œì‘ ===');
            const documentLocation = document.getElementById('document-location');
            
            // ì‚¬ìš© ê°€ëŠ¥í•œ í´ë” ëª©ë¡ ìƒì„±
            documentLocation.innerHTML = '<option value="">ğŸ“ ë£¨íŠ¸</option>';
            
            function addFolderOptions(folderList, prefix = '') {
                folderList.forEach(folder => {
                    const displayName = prefix ? `${prefix} > ${folder.name}` : folder.name;
                    const option = document.createElement('option');
                    option.value = folder.id;
                    option.textContent = `ğŸ“ ${displayName}`;
                    documentLocation.appendChild(option);
                    
                    if (folder.children && folder.children.length > 0) {
                        addFolderOptions(folder.children, displayName);
                    }
                });
            }
            
            addFolderOptions(folders);
            documentLocation.value = selectedFolder || '';
            console.log('í´ë” ìœ„ì¹˜ ì„¤ì • ì™„ë£Œ:', documentLocation.value);
            
            // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            selectedFile = null;
            console.log('selectedFile ì´ˆê¸°í™”:', selectedFile);
            
            const selectedFileInfoEl = document.getElementById('selected-file-info');
            if (selectedFileInfoEl) {
                selectedFileInfoEl.classList.add('hidden');
                console.log('íŒŒì¼ ì •ë³´ ì˜ì—­ ìˆ¨ê¹€');
            }
            
            const fileInput = document.getElementById('file-input');
            if (fileInput) {
                fileInput.value = '';
                console.log('íŒŒì¼ ì…ë ¥ ìš”ì†Œ ì´ˆê¸°í™” ì™„ë£Œ');
            } else {
                console.error('file-input ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
            
            console.log('ëª¨ë‹¬ ì´ˆê¸° ìƒíƒœ:', { selectedFile });
            updateUploadButton();
            
            const modal = document.getElementById('document-modal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('ëª¨ë‹¬ í‘œì‹œ ì™„ë£Œ');
            } else {
                console.error('document-modal ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
            
            console.log('=== ë¬¸ì„œ ëª¨ë‹¬ ì—´ê¸° ì™„ë£Œ ===');
        }

        function closeDocumentModal() {
            console.log('ë¬¸ì„œ ëª¨ë‹¬ ë‹«ê¸°');
            document.getElementById('document-modal').style.display = 'none';
            document.getElementById('selected-file-info').classList.add('hidden');
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            const fileInput = document.getElementById('file-input');
            if (fileInput) {
                fileInput.value = '';
            }
            
            selectedFile = null;
            console.log('selectedFile ì´ˆê¸°í™”ë¨');
            updateUploadButton();
        }

        function triggerFileInput() {
            console.log('íŒŒì¼ ì…ë ¥ íŠ¸ë¦¬ê±° í˜¸ì¶œë¨');
            const fileInput = document.getElementById('file-input');
            console.log('íŒŒì¼ ì…ë ¥ ìš”ì†Œ:', fileInput);
            
            if (fileInput) {
                console.log('íŒŒì¼ ì…ë ¥ ìš”ì†Œ í´ë¦­ ì‹œë„');
                try {
                    fileInput.click();
                    console.log('íŒŒì¼ ì…ë ¥ ìš”ì†Œ í´ë¦­ ì„±ê³µ');
                } catch (error) {
                    console.error('íŒŒì¼ ì…ë ¥ ìš”ì†Œ í´ë¦­ ì‹¤íŒ¨:', error);
                }
            } else {
                console.error('file-input ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                
                // ëŒ€ì•ˆ: ëª¨ë“  input[type="file"] ìš”ì†Œ ì°¾ê¸°
                const allFileInputs = document.querySelectorAll('input[type="file"]');
                console.log('ì°¾ì€ ëª¨ë“  íŒŒì¼ ì…ë ¥ ìš”ì†Œë“¤:', allFileInputs);
                
                if (allFileInputs.length > 0) {
                    console.log('ì²« ë²ˆì§¸ íŒŒì¼ ì…ë ¥ ìš”ì†Œ í´ë¦­ ì‹œë„');
                    allFileInputs[0].click();
                }
            }
        }

        function updateUploadButton() {
            document.getElementById('upload-btn').disabled = !selectedFile;
        }

        // íŒŒì¼ ì—…ë¡œë“œ í•¨ìˆ˜ (ë””ë²„ê¹… ê°•í™”)
        async function uploadDocument() {
            console.log(`=== íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘ ===`);
            
            if (!selectedFile) {
                console.error('ì„ íƒëœ íŒŒì¼ì´ ì—†ìŒ');
                return;
            }

            const folderId = document.getElementById('document-location').value || null;
            const uploadBtn = document.getElementById('upload-btn');
            
            console.log('íŒŒì¼ ì—…ë¡œë“œ íŒŒë¼ë¯¸í„°:', { 
                fileName: selectedFile.name, 
                folderId, 
                currentTab 
            });
            
            // ì—…ë¡œë“œí•  í´ë” ì •ë³´ í™•ì¸
            if (folderId) {
                const targetFolder = findFolderById(folders, folderId);
                console.log(`ì—…ë¡œë“œ ëŒ€ìƒ í´ë”: "${targetFolder?.name}" (id: ${folderId})`);
            } else {
                console.log('ì—…ë¡œë“œ ëŒ€ìƒ: ë£¨íŠ¸ í´ë”');
            }
            
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<div class="loading"></div>ì—…ë¡œë“œ ì¤‘...';

            try {
                // 1. í˜„ì¬ í¼ì¹¨ ìƒíƒœ ì €ì¥
                const expandedFolders = collectExpandedFolders(folders);
                console.log('í˜„ì¬ í¼ì³ì§„ í´ë”ë“¤:', expandedFolders);
                
                // 2. íŒŒì¼ ì—…ë¡œë“œ API í˜¸ì¶œ
                console.log('íŒŒì¼ ì—…ë¡œë“œ API í˜¸ì¶œ ì¤‘...');
                const uploadedFile = await uploadFileApi(selectedFile, folderId, currentTab);
                console.log('íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ:', uploadedFile);
                showToast('íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeDocumentModal();
                
                // 3. í´ë” ë°ì´í„°ë¥¼ ìƒˆë¡œ ë¡œë“œ
                console.log('í´ë” ë°ì´í„° ìƒˆë¡œ ë¡œë“œ ì¤‘...');
                await loadFolders();
                
                // 4. ì´ì „ í¼ì¹¨ ìƒíƒœ ë³µì›
                console.log('í¼ì¹¨ ìƒíƒœ ë³µì› ì¤‘...');
                restoreExpandedFolders(folders, expandedFolders);
                
                // 5. íŒŒì¼ì´ ì—…ë¡œë“œëœ í´ë”ê¹Œì§€ì˜ ê²½ë¡œë¥¼ ìë™ìœ¼ë¡œ í¼ì¹˜ê¸°
                if (folderId) {
                    console.log(`ì—…ë¡œë“œëœ í´ë”(${folderId})ë¡œ ê²½ë¡œ í¼ì¹˜ê¸° ì‹œì‘`);
                    autoExpandToFolder(folderId);
                } else {
                    console.log('ë£¨íŠ¸ì— ì—…ë¡œë“œë¨ - ì¶”ê°€ í¼ì¹˜ê¸° ë¶ˆí•„ìš”');
                }
                
                // 6. í´ë” êµ¬ì¡° ë¡œê¹…
                console.log('=== í˜„ì¬ í´ë” êµ¬ì¡° ===');
                logFolderStructure(folders);
                
                // 7. UI ìƒˆë¡œê³ ì¹¨
                console.log('íŒŒì¼ íŠ¸ë¦¬ ë Œë”ë§ ì‹œì‘...');
                await renderFileTreeWithoutReload();
                
                console.log(`=== íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ ===`);
                
            } catch (error) {
                console.error('íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                showToast(`íŒŒì¼ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`, true);
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'ì—…ë¡œë“œ';
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM ë¡œë“œ ì™„ë£Œ');
            
            // ì´ˆê¸° ë³€ìˆ˜ ìƒíƒœ í™•ì¸
            console.log('ì´ˆê¸° ì „ì—­ ë³€ìˆ˜ ìƒíƒœ:', {
                currentTab,
                selectedFolder,
                selectedFile,
                currentView
            });
            
            // Office íŒŒì¼ ê´€ë ¨ í•¨ìˆ˜ë“¤ì„ ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ (iframeì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
            window.downloadOfficeFile = downloadOfficeFile;
            window.closeOfficePreview = closeOfficePreview;
            window.onOfficePreviewLoaded = onOfficePreviewLoaded;
            window.onOfficeIframeLoaded = onOfficeIframeLoaded;
            
            // íƒ­ ì´ë²¤íŠ¸
            document.getElementById('tab-my').addEventListener('click', () => switchTab('my'));
            document.getElementById('tab-public').addEventListener('click', () => switchTab('public'));
            
            // íŒŒì¼ ì…ë ¥ ì´ë²¤íŠ¸ (ê°•í™”ëœ ë²„ì „)
            const fileInput = document.getElementById('file-input');
            const fileUploadArea = document.querySelector('.file-upload-area');
            
            if (fileInput) {
                console.log('íŒŒì¼ ì…ë ¥ ìš”ì†Œ ì°¾ìŒ:', fileInput);
                
                fileInput.addEventListener('change', function(event) {
                    console.log('íŒŒì¼ ì…ë ¥ ì´ë²¤íŠ¸ ë°œìƒ!');
                    console.log('event.target:', event.target);
                    console.log('event.target.files:', event.target.files);
                    console.log('event.target.files.length:', event.target.files.length);
                    
                    const file = event.target.files[0];
                    console.log('ì„ íƒëœ íŒŒì¼:', file);
                    
                    if (file) {
                        console.log('íŒŒì¼ ì •ë³´:', {
                            name: file.name,
                            size: file.size,
                            type: file.type
                        });
                        
                        selectedFile = file;
                        console.log('selectedFile ì„¤ì •ë¨:', selectedFile.name);
                        
                        const fileNameEl = document.getElementById('file-name');
                        const fileSizeEl = document.getElementById('file-size');
                        const selectedFileInfoEl = document.getElementById('selected-file-info');
                        
                        if (fileNameEl) {
                            fileNameEl.textContent = file.name;
                            console.log('íŒŒì¼ëª… í‘œì‹œë¨:', file.name);
                        } else {
                            console.error('file-name ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        }
                        
                        if (fileSizeEl) {
                            fileSizeEl.textContent = formatFileSize(file.size);
                            console.log('íŒŒì¼ í¬ê¸° í‘œì‹œë¨:', formatFileSize(file.size));
                        } else {
                            console.error('file-size ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        }
                        
                        if (selectedFileInfoEl) {
                            selectedFileInfoEl.classList.remove('hidden');
                            console.log('íŒŒì¼ ì •ë³´ ì˜ì—­ í‘œì‹œë¨');
                        } else {
                            console.error('selected-file-info ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        }
                        
                        updateUploadButton();
                    } else {
                        console.log('íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•ŠìŒ');
                        selectedFile = null;
                        updateUploadButton();
                    }
                });
                
                // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ì¶”ê°€
                if (fileUploadArea) {
                    console.log('ë“œë˜ê·¸&ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •');
                    
                    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                        fileUploadArea.addEventListener(eventName, preventDefaults, false);
                    });
                    
                    function preventDefaults(e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    
                    ['dragenter', 'dragover'].forEach(eventName => {
                        fileUploadArea.addEventListener(eventName, highlight, false);
                    });
                    
                    ['dragleave', 'drop'].forEach(eventName => {
                        fileUploadArea.addEventListener(eventName, unhighlight, false);
                    });
                    
                    function highlight() {
                        fileUploadArea.classList.add('dragover');
                    }
                    
                    function unhighlight() {
                        fileUploadArea.classList.remove('dragover');
                    }
                    
                    fileUploadArea.addEventListener('drop', handleDrop, false);
                    
                    function handleDrop(e) {
                        console.log('íŒŒì¼ ë“œë¡­ë¨');
                        const dt = e.dataTransfer;
                        const files = dt.files;
                        console.log('ë“œë¡­ëœ íŒŒì¼ë“¤:', files);
                        
                        if (files.length > 0) {
                            const file = files[0];
                            console.log('ì²« ë²ˆì§¸ íŒŒì¼ ì„ íƒ:', file.name);
                            
                            // íŒŒì¼ ì…ë ¥ ìš”ì†Œì— íŒŒì¼ ì„¤ì •
                            const dataTransfer = new DataTransfer();
                            dataTransfer.items.add(file);
                            fileInput.files = dataTransfer.files;
                            
                            // change ì´ë²¤íŠ¸ ìˆ˜ë™ ë°œìƒ
                            const changeEvent = new Event('change', { bubbles: true });
                            fileInput.dispatchEvent(changeEvent);
                        }
                    }
                } else {
                    console.error('file-upload-area ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            } else {
                console.error('file-input ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
            
            // Enter í‚¤ ì´ë²¤íŠ¸
            document.getElementById('folder-name').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') createFolder();
            });
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal-overlay')) {
                    e.target.style.display = 'none';
                }
            });
            
            // ì´ˆê¸° ë¡œë“œ - ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸ í›„ ì§„í–‰
            console.log('ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...');
            await renderFileTree();
            updateDocumentContent();
        });
    </script>
</body>
</html>